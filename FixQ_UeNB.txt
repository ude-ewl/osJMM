****

QGMAXCAPDISPATCH(T,IAGK_Y(IA,IGDISPATCH)) $IT_OPT(T)..

    VGELEC_T(T,IA,IGDISPATCH)+ VGELEC_DPOS_T(T,IA,IGDISPATCH)- VGELEC_DNEG_T(T,IA,IGDISPATCH)
     + VGE_ANCPOS(T,IA,IGDISPATCH) $IGSPINNING(IGDISPATCH)
     + VGE_SPIN_ANCPOS(T,IA,IGDISPATCH)
     + VGE_NONSPIN_ANCPOS(T,IA,IGDISPATCH)$IGDISPATCH_NOUC(IGDISPATCH)

  =L=


(IGELECCAPEFF(IA,IGDISPATCH,T)*IMaxGen(IA,IGDispatch,T)* VGONLINE_T(T,IA,IGDISPATCH))$(IGUC(IGDISPATCH))
   + (IGELECCAPEFF(IA,IGDISPATCH,T)*IMaxGen(IA,IGDispatch,T))$(IGDISPATCH_NOUC(IGDISPATCH))
   - (VGHEAT_T(T,IA,IGDISPATCH) * GDATA(IA,IGDISPATCH,'GDCV'))$IGEXTRACTION(IGDISPATCH)
   +  VQMAXCAP(T,IA,IGDISPATCH,'IPLUS')
;

****

QGMINCAPDISPATCH(T,IAGK_Y(IA,IGDISPATCH)) $(IT_OPT(T))..

    VGELEC_T(T,IA,IGDISPATCH) + VGELEC_DPOS_T(T,IA,IGDISPATCH)- VGELEC_DNEG_T(T,IA,IGDISPATCH)
    - VGE_ANCNEG(T,IA,IGDISPATCH) $IGSPINNING(IGDISPATCH)
    - VGE_SPIN_ANCNEG(T,IA,IGDISPATCH)

   =G=

    GDATA(IA,IGDISPATCH,'GDMINLOADFACTOR')*(

(IGELECCAPEFF(IA,IGDISPATCH,T)* VGONLINE_T(T,IA,IGDISPATCH))$(IGUC(IGDISPATCH))
   )

   - VQMINCAP(T,IA,IGDISPATCH,'IMINUS')
   - (VGHEAT_T(T,IA,IGDISPATCH) * GDATA(IA,IGDISPATCH,'GDCV'))$(IGEXTRACTION(IGDISPATCH))
;



QGONLCAPMIN_CHP(T,IAGK_Y(IA,IGUC_NOALWAYS)) $(IT_OPT(T) AND IACHP_Exo(IA) AND IGCHP_EXO(IGUC_NOALWAYS))..

  VGONLINE_T(T,IA,IGUC_NOALWAYS)$(IACHP_Exo(IA) AND IGCHP_EXO(IGUC_NOALWAYS))

  =G=

   + IMINCHPFACTOR(IA,IGUC_NOALWAYS,T)$(IGCHPBOUNDE(IGUC_NOALWAYS))
$ifi     '%CHP%' == Yes + ((IMINVGONLINE_CHP(IA,IGUC_NOALWAYS,T) - VGHEAT_T(T,IA,IGUC_NOALWAYS) * GDATA(IA,IGUC_NOALWAYS,'GDCV'))*0.999*(1-IG_UNP_OUTAGE(IA,IGUC_NOALWAYS,T)))$(IGFIXHEAT(IGUC_NOALWAYS))

   /max(IGELECCAPACITY_Y(IA,IGUC_NOALWAYS)$(IGFIXHEAT(IGUC_NOALWAYS)),0.001)
;



$ifi '%CHP%' == Yes       LOOP(IAGK_Y(IA,IGFIXHEAT),
$ifi '%CHP%' == Yes              LOOP(T$(ORD(T)>1),

$ifi '%CHP%' == Yes    VGHEAT_T.FX(T,IA,IGFIXHEAT)= IHEATEXT_EXO(IA,IGFIXHEAT,T);
$ifi '%CHP%' == Yes    VGE_ANCPOS.FX(T,IA,IGFIXHEAT)$IGBACKPR(IGFIXHEAT) = 0;
$ifi '%CHP%' == Yes    VGE_SPIN_ANCPOS.FX(T,IA,IGFIXHEAT)$IGBACKPR(IGFIXHEAT) = 0;
$ifi '%CHP%' == Yes    VGE_NONSPIN_ANCPOS.FX(T,IA,IGFIXHEAT)$IGBACKPR(IGFIXHEAT) = 0;
$ifi '%CHP%' == Yes    VGE_ANCNEG.FX(T,IA,IGFIXHEAT)$IGBACKPR(IGFIXHEAT) = 0;
$ifi '%CHP%' == Yes    VGE_SPIN_ANCNEG.FX(T,IA,IGFIXHEAT)$IGBACKPR(IGFIXHEAT) = 0;

$ifi '%CHP%' == Yes       );
$ifi '%CHP%' == Yes       );



$ifi '%CHP%'==Yes                IHEATEXT_EXO(IA,G,T)           = BASE_FIXQ(IA,G,BASETIME);



IMINVGONLINE_CHP(IA,IGFIXHEAT,T)= BASE_MinVGOnline_CHP_VAR_T(IA,IGFIXHEAT,BASETIME);



* ---- QGCBGBPR Backpressure ---- *{
* Production day-ahead + Up regulation - Down regulation = Heat production * CB-factor

QGCBGBPR(T,IAGK_Y(IA,IGBACKPR)) $((IT_OPT(T)) AND NOT(IGCHPBOUNDE(IGBACKPR)))..

    VGELEC_T(T,IA,IGBACKPR) + VGELEC_DPOS_T(T,IA,IGBACKPR) - VGELEC_DNEG_T(T,IA,IGBACKPR)

  =E=

    VGHEAT_T(T,IA,IGBACKPR) * GDATA(IA,IGBACKPR,'GDCB')* (1-IG_UNP_OUTAGE(IA,IGBACKPR,T))
;

* ---- QGCBGEXT Extraction ---- *{
* Production day-ahead + Up regulation - Down regulation - Primary negative reserve
* > Heat production * CB-factor

QGCBGEXT(T,IAGK_Y(IA,IGEXTRACTION)) $((IT_OPT(T)) AND NOT(IGCHPBOUNDE(IGEXTRACTION)))..

   VGELEC_T(T,IA,IGEXTRACTION) + VGELEC_DPOS_T(T,IA,IGEXTRACTION) - VGELEC_DNEG_T(T,IA,IGEXTRACTION)
   - VGE_ANCNEG(T,IA,IGEXTRACTION) $IGSPINNING(IGEXTRACTION)

  =G=

   VGHEAT_T(T,IA,IGEXTRACTION) * GDATA(IA,IGEXTRACTION,'GDCB') * (1-IG_UNP_OUTAGE(IA,IGEXTRACTION,T))
;
